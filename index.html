<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8"/>
    <title>Shamir's Keystore</title>
    <style>
      @import url('https://fonts.googleapis.com/css?family=Crimson+Text|Fira+Code|Montserrat&amp;display=swap');
      div.main {
        width: 80%; border-style: outset; border-width: 1px; border-radius: 3px; border-color: rgb(224,224,224); margin-left: auto; margin-right: auto;
        padding-left: 1em; padding-right: 1em; padding-top: 0.25em; padding-bottom: 0.25em; background-color: rgb(224,224,224)
      }
      p.headline-0 {
        background-color: rgb(178,24,43); color: rgb(253,219,199); font-family: 'Montserrat', sans-serif; padding: 3px; border-radius: 3px; font-size: 1.5em; 
        padding-left: 1rem; padding-right: 0.75rem
      }
      p.headline-1 {
        background-color: rgb(77,77,77); color: rgb(253,219,199); font-family: 'Montserrat', sans-serif; padding: 3px; border-radius: 3px; font-size: 1em; padding-left: 1rem
      }
      p.section {
        color: rgb(26,26,26); font-family: 'Crimson Text', serif; text-align: justify
      }
      div.code {
        border-style: dashed; border-width: 1px; border-color: rgb(103,0,31); background-color: rgb(253,219,199); width: 60%; margin-left: auto; margin-right: auto
      }
      p.code {
        font-family: 'Fira Code', monospace; font-size: 12px; text-align: left; padding-left: 1rem
      }
      p.formula {
        font-style: italic; font-family: 'Fira Code', monospace; text-align: center
      }
      span.formula {
        font-style: italic; font-family: 'Fira Code', monospace;
      }
      div.drop-down-button {
        height: 0rem; padding-right: 1rem; position: relative; float: right;
      }
      img.menu {
        height: 1.5rem; margin-top: 0.8rem;
      }
      div.drop-down-content {
        display: none; background-color: rgb(253,219,199); padding: 1rem; position: absolute; top: 0; left: -5rem; width: 9rem;
        border-radius: 0.25rem; border-color: rgb(77,77,77); border-style: solid; border-width: 1px
      }
      div.drop-down-button:hover div.drop-down-content {
        display: inline-block;
      }
      a.menu {
        color: rgb(77,77,77); font-size: 0.9rem; 
      }
      p.menu {
        line-height: 0.8rem
      }
    </style>
  </head>
  <body style="background-color: rgb(255,255,255)">
    <div class="main">
      <p style="color: rgb(26,26,26); font-family: 'Crimson Text', serif; font-style: italic; text-align: right; border-bottom-style: solid; border-bottom-width: 1px; 
         border-bottom-color: rgb(26,26,26)">Last updated: 2020-03-19</p>
      <div class="drop-down-button">
        <img class="menu" src="menu-widget.png" alt="menu"/>
        <div class="drop-down-content">
          <p class="menu"><a class="menu" href="#1">Shamir's Keystore</a></p>
          <p class="menu"><a class="menu" href="#2">Abstract</a></p>
          <p class="menu"><a class="menu" href="#3">Build</a></p>
          <p class="menu"><a class="menu" href="#4">Source Control</a></p>
          <p class="menu"><a class="menu" href="#5">The Algorithm</a></p>
        </div>
      </div>
      <p id="1" class="headline-0">Shamir's Keystore</p>
      <p id="2" class="headline-1">Abstract</p>
      <p class="section">
        This <a href="https://docs.oracle.com/en/java/javase/11/security/java-cryptography-architecture-jca-reference-guide.html">JCA provider</a> presently implements 
        <a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Shamir's Secret Sharing</a> using
        Newton Polynomials. Building on this, a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/security/KeyStore.html">KeyStore</a> Engine
        as defined by the <a href="https://docs.oracle.com/en/java/javase/11/security/howtoimplaprovider.html">Java Cryptographic Architecture</a> is provided. Such a keystore instance might 
        be unlocked - apart from the master password - by a previously computed subset of secret shares. In order to be able to reconstruct the master password a certain number of secret shares 
        above a given threshold must be combined. Shamirs scheme is information-theoretically secure. This means that an attacker does not get any additional information about the original master 
        password with fewer shares as defined by the given threshold. In this way, it is possible to enforce the e.g. the four-eye-principle.
      </p>
      <p id="3" class="headline-1">Build</p>
      <p class="section">
        First clone the project:
      </p>
      <div class="code">
        <p class="code">
          git clone https://github.com/chr78rm/shamirs-keystore.git<br/>
          cd shamirs-keystore
        </p>
      </div>
      <p class="section">
        <a href="https://maven.apache.org/">Maven</a> and a JDK11+ is required for the build of the multi-module project:
      </p>
      <div class="code">
        <p class="code">
          mvn clean install
        </p>
      </div>
      <p class="section">
        Above command will compile the sources, run the tests and install the provider into the local Maven repo.
      </p>
      <p id="4" class="headline-1">Source Control</p>
      <p class="section">
        The source code is hosted in GitHub: <a href="https://github.com/chr78rm/shamirs-keystore">https://github.com/chr78rm/shamirs-keystore</a>.
        <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" style="float: right">
          <img style="height: 1.5rem" src="https://www.gnu.org/graphics/gplv3-with-text-84x42.png" alt="gplv3"/>
        </a>
      </p>
      <p id="5" class="headline-1">The Algorithm</p>
      <p class="section">
        Consider the polynomial
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = a<sub>k-1</sub>x<sup>k-1</sup> + ... + a<sub>2</sub>x<sup>2</sup> + a<sub>1</sub>x + a<sub>0</sub>
      </p>
      <p class="section">
        of degree <span class="formula">k-1</span> given in the canonical form. Recall that you need <span class="formula">k</span> supporting points to recover a polynomial of
        degree <span class="formula">k-1</span>. Shamir's <span class="formula">(k,n)</span> threshold scheme is building upon this property. A trusted 
        authority randomly selects a polynomial <span class="formula">P<sub>k-1</sub></span> and computes <span class="formula">n</span> supporting points whereby 
        <span class="formula">n >= k</span> applies. 
        The to be shared secret <span class="formula">s</span> is encoded as <span class="formula">a<sub>0</sub></span>. The <span class="formula">n</span> supporting points 
        are distributed among the participants. To compute the original secret <span class="formula">s</span> the participants must combine <span class="formula">k</span> of 
        the supporting points. In order to avoid that an adversary gains any knowledge about the secret by merging less than <span class="formula">k</span> supporting points 
        all computations will by implemented by using finite field arithmetic. That means we choose a finite field <span class="formula">&#120125;<sub>p</sub></span> whereby 
        <span class="formula">p</span> is prime and <span class="formula">a<sub>0</sub> &lt; p</span> applies.
      </p> 
      <p class="section">
        The simplest procedure for reconstructing a polynomial <span class="formula">P</span> of degree <span class="formula">k-1</span> with given <span class="formula">k</span> 
        supporting points <span class="formula">(x<sub>0</sub>,y<sub>0</sub>),...,(x<sub>k-1</sub>,y<sub>k-1</sub>)</span> is by devising a system of 
        <span class="formula">k</span> linear equations. A parabola, for instance, is defined by three supporting points 
        <span class="formula">(x<sub>0</sub>,y<sub>0</sub>),(x<sub>1</sub>,y<sub>1</sub>),(x<sub>2</sub>,y<sub>2</sub>)</span>. The coefficients
        <span class="formula">a<sub>0</sub>,a<sub>1</sub>,a<sub>2</sub></span> can be computed by solving the system of linear equations below:
      </p>
      <p class="formula">
        y<sub>0</sub> = a<sub>2</sub>x<sub>0</sub><sup>2</sup> + a<sub>1</sub>x<sub>0</sub> + a<sub>0</sub><br/>
        y<sub>1</sub> = a<sub>2</sub>x<sub>1</sub><sup>2</sup> + a<sub>1</sub>x<sub>1</sub> + a<sub>0</sub><br/>
        y<sub>2</sub> = a<sub>2</sub>x<sub>2</sub><sup>2</sup> + a<sub>1</sub>x<sub>2</sub> + a<sub>0</sub><br/>
      </p>
      <p class="section">
        There are, however, more efficient algorithms. This distribution uses the Newton interpolation method to recover the secret <span class="formula">s</span>.
        A Newton polynomial of degree <span class="formula">k-1</span> is given by
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = <span style="font-size: 18px; font-style: normal">&#x1D768;</span>
        <sub style="font-size: 10px; position: relative; top: 0.25em; left: -0.75em">i=0</sub>
        <sup style="position: relative; left: -3.5em; top: -0.25em; font-size: 10px">k-1</sup>
        <span style="position: relative; left: -2.25em;">c<sub>i</sub>N<sub>i</sub>(x)</span>
      </p>
      <p class="section">
        with Newton coefficients <span class="formula">c<sub>0</sub>,c<sub>1</sub>,...,c<sub>k-1</sub></span> and the Newton basis polynomials
        <span class="formula">N<sub>0</sub> = 1</span> and 
        <span class="formula">
          N<sub>i</sub> = <span style="font-size: 18px; font-style: normal">&#x1D79F;</span>
          <sub style="font-size: 10px; position: relative; top: 0.25em; left: -1em">j=0</sub>
          <sup style="position: relative; left: -3.75em; top: -0.25em; font-size: 10px">i-1</sup>
          <span style="position: relative; left: -2.5em;">(x - x<sub>j</sub>).</span>
        </span>
      </p>
      <p class="section">
        This gives
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = c<sub>0</sub> + c<sub>1</sub>(x - x<sub>0</sub>) + c<sub>2</sub>(x - x<sub>0</sub>)(x - x<sub>1</sub>) + &#x22EF; + c<sub>k-1</sub>(x - x<sub>0</sub>) &#x22EF; (x - x<sub>k-2</sub>)
      </p>
      <p class="section">
        By applying <span class="formula">x &#x2190; x<sub>0</sub>,x &#x2190; x<sub>1</sub>,x &#x2190; x<sub>2</sub>,...</span> it follows
      </p>
      <p class="formula" style="text-align: left; padding-left: 10em">
        P(x<sub>0</sub>) = c<sub>0</sub><br/>
        P(x<sub>1</sub>) = c<sub>0</sub> + c<sub>1</sub>(x<sub>1</sub> - x<sub>0</sub>)<br/>
        P(x<sub>2</sub>) = c<sub>0</sub> + c<sub>1</sub>(x<sub>2</sub> - x<sub>0</sub>) + c<sub>2</sub>(x<sub>2</sub> - x<sub>0</sub>)(x<sub>2</sub> - x<sub>1</sub>)<br/>
        P(x<sub>3</sub>) = c<sub>0</sub> + c<sub>1</sub>(x<sub>3</sub> - x<sub>0</sub>) + c<sub>2</sub>(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>) + c<sub>3</sub>(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>)(x<sub>3</sub> - x<sub>2</sub>)<br/>
        <span style="font-style: normal; position: relative; left: 2em">&#x22EE;</span><span style="font-style: normal; position: relative; left: 5em">&#x22EE;</span>
      </p>
      <p class="section">
        Since we are interested in recovering the Newton polynomial by using the supporting points we rearrange the equations above:
      </p>
      <p class="formula" style="text-align: left; padding-left: 10em">
        c<sub>0</sub> = y<sub>0</sub><br/>
        c<sub>1</sub> = (y<sub>1</sub> - c<sub>0</sub>)/(x<sub>1</sub> - x<sub>0</sub>)<br/>
        c<sub>2</sub> = (y<sub>2</sub> - c<sub>0</sub> - c<sub>1</sub>(x<sub>2</sub> - x<sub>0</sub>))/(x<sub>2</sub> - x<sub>0</sub>)(x<sub>2</sub> - x<sub>1</sub>)<br/>
        c<sub>3</sub> = (y<sub>3</sub> - c<sub>0</sub> - c<sub>1</sub>(x<sub>3</sub> - x<sub>0</sub>) - c<sub>2</sub>(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>))/(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>)(x<sub>3</sub> - x<sub>2</sub>)<br/>
        <span style="font-style: normal; position: relative; left: 1em">&#x22EE;</span><span style="font-style: normal; position: relative; left: 3em">&#x22EE;</span>
      </p>
      <p class="section">
        Now we can clearly see a recurring pattern. Thus, the Newton coefficients can be computed by a recursive procedure and by memoizing the already calculated 
        coefficients (dynamic programming), 
        see <a href="https://github.com/chr78rm/shamirs-keystore/blob/master/shamirs-secret-sharing/src/main/scala/de/christofreichardt/scala/shamir/NewtonInterpolation.scala">NewtonInterpolation.scala</a>
        for details.
      </p>
      <p class="section">
        We need to evaluate the interpolated polynom at least at one point, namely at <span class="formula">P(0) = a<sub>0</sub></span> to recover the original secret. An efficient
        way of doing this is by applying Horner's scheme. The Newton polynomial <span class="formula">P</span> of degree <span class="formula">k-1</span> can be rewritten as
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = c<sub>0</sub> + (x - x<sub>0</sub>)[c<sub>1</sub> + (x - x<sub>1</sub>)[c<sub>2</sub> + &#x22EF; + c<sub>k-1</sub>(x - x<sub>k-2</sub>)] &#x22EF; ]
      </p>
      <p class="section">
        so that <span class="formula">P(x)</span> can be calculated recursively:
      </p>
      <p class="formula" style="text-align: left; padding-left: 10em">
        b<sub>0</sub> = c<sub>0</sub> + (x - x<sub>0</sub>)b<sub>1</sub><br/>
        b<sub>1</sub> = c<sub>1</sub> + (x - x<sub>1</sub>)b<sub>2</sub><br/>
        b<sub>2</sub> = c<sub>2</sub> + (x - x<sub>2</sub>)b<sub>3</sub><br/>
        <span style="font-style: normal; position: relative; left: 1em">&#x22EE;</span><span style="font-style: normal; position: relative; left: 3em">&#x22EE;</span><br/>
        b<sub>k-1</sub> = c<sub>k-1</sub>
      </p>
      <p class="section">
        where <span class="formula">P(x) = b<sub>0</sub></span> .
      </p>
      <div style="text-align: center; border-top-style: solid; border-top-color: rgb(26,26,26); border-top-width: 1px; margin-top: 1rem">
        <img style="" src="./impressum.png" alt="Impressum" />
      </div>
    </div>
  </body>
</html>